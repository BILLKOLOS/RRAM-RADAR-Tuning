import matplotlib as mpl, numpy as np, pandas as pd
import matplotlib.pyplot as plt
from matplotlib.ticker import FormatStrFormatter

# Chip number
chipnum = 2

# LaTEX quality figures 
mpl.rcParams.update(
    {
    'text.usetex': True,
    'pgf.texsystem': 'lualatex',
    'pgf.rcfonts': True
    }
)
plt.rc('font', family='serif', serif='Times', size=13)

# Setup figure
fig, ax = plt.subplots(figsize=(4,3))
plt.title('Pulses Required for Target Error')
plt.xlabel('Mean Pulses Required')
plt.ylabel('Error (\%)')
plt.tight_layout()

# Load SDR data
names = ['addr', 'nreads', 'nsets', 'nresets', 'rf', 'if', 'rlo', 'rhi', 'success', 'attempts1', 'attempts2']
if chipnum == 1:
    fnames = ['../ispp/data/ispp-4wl-eval-chip1-6-6-20.csv', '../fppv/data/fppv-4wl-eval-chip1-6-6-20.csv', '../fppv/data/fppv-4wl-eval-chip1-6-6-20.csv', '../sdr/data/infopt/sdr-infopt-4wl-eval-chip1-6-8-20.csv']
if chipnum == 2:
    fnames = ['../ispp/data/ispp-4wl-eval-chip2-6-17-20.csv', '../fppv/data/fppv-4wl-eval-chip2-6-17-20.csv', '../fppv/data/fppv-4wl-eval-chip2-6-17-20.csv', '../sdr/data/infopt/sdr-infopt-4wl-eval-chip2-6-17-20.csv', '../sdr/data/infopt/sdr-wl0.06-bl0.80-sl0.30-7.00-6-22-20-1k.csv', '../sdr/data/infopt/sdr-wl0.06-bl0.80-sl0.30-7.00-6-22-20-6k.csv', '../sdr/data/infopt/sdr-wl0.06-bl0.80-sl0.30-7.00-6-22-20-11k.csv', '../sdr/data/infopt/sdr-wl0.06-bl0.80-sl0.30-7.00-6-22-20-20k.csv', '../sdr/data/infopt/sdr-wl0.06-bl0.80-sl0.30-7.00-6-22-20.csv', '../ispp/data/ispp-wl0.06-bl0.80-sl0.30-7.00-6-22-20.csv']
for i, fname in enumerate(fnames):
    data = pd.read_csv(fname, delimiter='\t', names=names, index_col=False)
    data['npulses'] = data['nsets'] + data['nresets'] - 1
    rlos = data['rlo'].unique()
    data['bin'] = data['rlo'].apply(lambda x: np.where(rlos == x)[0][0])
    data = data[data['bin'] != 7]
    if i == 1:
        if chipnum == 1:
            badaddrs = [4103, 4115, 4170, 4242, 4243, 4295, 4437, 4441, 4490, 4532, 4554, 4593, 4607, 4660, 4665, 4670, 4688, 4749, 4854, 4855, 4866, 4896, 4901, 4908, 4935, 4937, 4947, 4962, 4982, 4984, 4986, 4989, 5059, 5120, 5121, 5125, 5126, 5133, 5138, 5150, 5188, 5191, 5221, 5224, 5238, 5246, 5261, 5322, 5330, 5332, 5339, 5344, 5369, 5389, 5390, 5421, 5422, 5437, 5444, 5468, 5481, 5483, 5487, 5490, 5517, 5533, 5549, 5555, 5589, 5603, 5624, 5652, 5687, 5692, 5736, 5760, 5784, 5854, 5872, 5880, 5896, 5901, 5905, 5926, 5927, 5960, 5981, 5987, 6000, 6016, 6019, 6031, 6050, 6075, 6091, 6109, 6129, 6132, 6236, 6245, 6281, 6289, 6306, 6337, 6339, 6355, 6358, 6384, 6425, 6426, 6461, 6468, 6477, 6479, 6500, 6503, 6504, 6508, 6510, 6537, 6542, 6547, 6563, 6591, 6594, 6633, 6664, 6666, 6687, 6706, 6746, 6793, 6805, 6806, 6828, 6831, 6837, 6884, 6898, 6910, 6917, 6927, 6956, 6968, 6986, 6998, 7017, 7033, 7050, 7053, 7055, 7059, 7068, 7073, 7093, 7112, 7114, 7119, 7123, 7128, 7146, 7179, 7183, 7186, 7223, 7236, 7245, 7251, 7263, 7293, 7297, 7300, 7309, 7310, 7312, 7315, 7320, 7327, 7341, 7354, 7357, 7367, 7373, 7376, 7397, 7411, 7428, 7433, 7461, 7469, 7471, 7491, 7498, 7519, 7526, 7545, 7586, 7590, 7606, 7616, 7627, 7676, 7686, 7693, 7714, 7725, 7732, 7733, 7772, 7779, 7786, 7790, 7793, 7814, 7815, 7817, 7823, 7830, 7832, 7858, 7861, 7883, 7916, 7926, 7938, 7954, 7955, 7958, 7963, 7965, 7974, 8013, 8020, 8022, 8032, 8044, 8067, 8070, 8072, 8078, 8086, 8114, 8116, 8119, 8128, 8144, 8149, 8156, 8157, 8160, 8166, 8168, 8173, 8174, 8175, 8237, 8285, 8288, 8289, 8291, 8304, 8317, 8342, 8345, 8361, 8369, 8371, 8373, 8387, 8400, 8409, 8410, 8414, 8418, 8423, 8426, 8430, 8431, 8459, 8462, 8474, 8495, 8504, 8522, 8525, 8530, 8571, 8574, 8585, 8589, 8600, 8616, 8619, 8620, 8625, 8642, 8643, 8655, 8663, 8689, 8694, 8697, 8715, 8728, 8731, 8757, 8766, 8769, 8776, 8782, 8785, 8792, 8800, 8802, 8810, 8815, 8819, 8821, 8837, 8841, 8844, 8851, 8874, 8899, 8911, 8919, 8934, 8937, 8940, 8961, 8969, 8975, 8988, 9006, 9011, 9012, 9014, 9022, 9029, 9047, 9050, 9063, 9069, 9080, 9091, 9095, 9104, 9122, 9138, 9139, 9147, 9152, 9165, 9173, 9183, 9192, 9214, 9221, 9227, 9231, 9237, 9240, 9256, 9260, 9261, 9264, 9265, 9268, 9273, 9287, 9293, 9304, 9307, 9320, 9331, 9335, 9339, 9385, 9389, 9406, 9408, 9413, 9414, 9420, 9424, 9430, 9431, 9432, 9435, 9440, 9445, 9448, 9456, 9469, 9478, 9480, 9485, 9488, 9508, 9509, 9532, 9559, 9567, 9572, 9576, 9579, 9584, 9594, 9602, 9607, 9611, 9615, 9619, 9652, 9673, 9674, 9680, 9696, 9699, 9703, 9709, 9711, 9721, 9728, 9732, 9743, 9747, 9748, 9759, 9764, 9765, 9766, 9769, 9770, 9776, 9793, 9808, 9813, 9824, 9827, 9842, 9843, 9848, 9852, 9862, 9870, 9896, 9898, 9903, 9909, 9911, 9918, 9924, 9928, 9935, 9936, 9960, 9962, 9965, 9967, 9973, 9986, 9999, 10006, 10007, 10011, 10014, 10015, 10016, 10026, 10029, 10031, 10032, 10038, 10056, 10060, 10067, 10073, 10083, 10085, 10096, 10101, 10106, 10113, 10119, 10126, 10131, 10142, 10144, 10145, 10166, 10177, 10180, 10186, 10192, 10197, 10199, 10204, 10207, 10212, 10217, 10221, 10223, 10229, 10230, 10231, 10237, 10241, 10244, 10252, 10253, 10264, 10272, 10274, 10285, 10286, 10291, 10294, 10300, 10309, 10314, 10316, 10317, 10320, 10324, 10333, 10335, 10344, 10345, 10348, 10350, 10355, 10357, 10359, 10362, 10369, 10374, 10376, 10377, 10379, 10380, 10382, 10392, 10407, 10422, 10424, 10429, 10430, 10431, 10447, 10452, 10463, 10467, 10473, 10485, 10486, 10487, 10501, 10520, 10526, 10531, 10547, 10560, 10572, 10581, 10583, 10619, 10622, 10628, 10634, 10657, 10669, 10676, 10737, 10760, 10762, 10766, 10774, 10783, 10790, 10792, 10795, 10802, 10805, 10818, 10826, 10832, 10859, 10866, 10877, 10890, 10892, 10902, 10908, 10912, 10925, 10928, 10931, 10940, 10948, 10960, 10978, 10984, 10985, 11003, 11005, 11006, 11011, 11027, 11036, 11042, 11050, 11058, 11067, 11068, 11072, 11079, 11092, 11099, 11110, 11111, 11118, 11125, 11126, 11129, 11142, 11150, 11166, 11174, 11178, 11185, 11201, 11215, 11233, 11236, 11276, 11284, 11286, 11295, 11299, 11301, 11317, 11346, 11356, 11363, 11371, 11373, 11374, 11376, 11380, 11395, 11405, 11406, 11427, 11443, 11449, 11460, 11473, 11476, 11490, 11491, 11495, 11512, 11527, 11532, 11536, 11540, 11541, 11561, 11573, 11582, 11584, 11589, 11593, 11597, 11619, 11644, 11645, 11648, 11668, 11695, 11696, 11702, 11708, 11715, 11720, 11723, 11742, 11745, 11746, 11754, 11768, 11782, 11785, 11786, 11792, 11798, 11800, 11825, 11827, 11881, 11909, 11919, 11921, 11926, 11939, 11942, 11946, 11949, 11952, 11965, 11972, 11974, 11996, 12010, 12013, 12026, 12043, 12045, 12052, 12055, 12057, 12064, 12075, 12077, 12086, 12087, 12102, 12115, 12123, 12126, 12130, 12151, 12152, 12159, 12162, 12180, 12183, 12198, 12200, 12206, 12210, 12211, 12219, 12221, 12223, 12226, 12227, 12244, 12248, 12253, 12256, 12260, 12262, 12263, 12266, 12272, 12278, 12281, 12287, 4137, 4305, 4407, 4423, 4485, 4503, 4630, 4763, 4774, 4785, 4907, 4974, 5006, 5010, 5027, 5075, 5094, 5129, 5172, 5176, 5267, 5304, 5356, 5366, 5385, 5415, 5439, 5494, 5558, 5644, 5683, 5686, 5716, 5733, 5768, 5803, 5840, 6025, 6030, 6055, 6101, 6231, 6328, 6374, 6466, 6482, 6502, 6644, 6658, 6679, 6836, 6933, 7140, 7224, 7269, 7336, 7344, 7380, 7429, 7486, 7512, 7533, 7579, 7639, 7675, 7843, 7880, 7895, 7939, 8050, 8075, 8126, 8234, 8243, 8295, 8313, 8339, 8367, 8383, 8402, 8432, 8437, 8533, 8536, 8549, 8583, 8588, 8613, 8628, 8639, 8672, 8676, 8678, 8691, 8722, 8726, 8759, 8808, 8828, 8836, 8868, 8901, 8932, 8953, 8981, 9032, 9061, 9078, 9126, 9168, 9229, 9302, 9309, 9325, 9340, 9348, 9353, 9355, 9360, 9367, 9402, 9403, 9410, 9447, 9506, 9529, 9531, 9554, 9570, 9601, 9612, 9623, 9678, 9693, 9731, 9783, 9825, 9851, 9874, 9885, 9892,]
            print "Bad addrs:", len(badaddrs)
            data = data[~data['addr'].isin(badaddrs)]
        if chipnum == 2:
            badaddrs = [4105, 4111, 4117, 4119, 4137, 4160, 4161, 4167, 4202, 4203, 4238, 4260, 4261, 4273, 4279, 4280, 4332, 4412, 4450, 4455, 4456, 4511, 4568, 4579, 4608, 4609, 4620, 4642, 4654, 4669, 4672, 4678, 4680, 4692, 4697, 4698, 4708, 4717, 4723, 4741, 4789, 4801, 4809, 4815, 4827, 4835, 4842, 4844, 4845, 4853, 4890, 4895, 4897, 4898, 4911, 4914, 4916, 4919, 4922, 4923, 4929, 4945, 4957, 4960, 4963, 4966, 4983, 4996, 5017, 5039, 5057, 5071, 5075, 5102, 5110, 5143, 5151, 5159, 5160, 5161, 5193, 5197, 5205, 5206, 5209, 5213, 5214, 5219, 5237, 5242, 5257, 5260, 5270, 5275, 5282, 5288, 5290, 5300, 5301, 5307, 5310, 5325, 5328, 5329, 5358, 5388, 5396, 5398, 5406, 5412, 5415, 5417, 5423, 5426, 5439, 5444, 5447, 5454, 5457, 5459, 5477, 5493, 5494, 5508, 5510, 5511, 5518, 5523, 5563, 5583, 5592, 5604, 5610, 5626, 5632, 5641, 5659, 5665, 5669, 5670, 5680, 5690, 5709, 5711, 5712, 5715, 5717, 5734, 5735, 5750, 5756, 5758, 5759, 5764, 5779, 5785, 5813, 5815, 5816, 5817, 5820, 5839, 5845, 5860, 5874, 5877, 5890, 5892, 5899, 5902, 5922, 5927, 5938, 5955, 5959, 5965, 5974, 5980, 5982, 6001, 6010, 6012, 6014, 6018, 6019, 6035, 6039, 6051, 6054, 6073, 6104, 6107, 6128, 6139, 6150, 6151, 6160, 6201, 6209, 6219, 6236, 6240, 6243, 6262, 6266, 6268, 6290, 6292, 6350, 6355, 6363, 6377, 6380, 6392, 6402, 6403, 6408, 6421, 6433, 6448, 6450, 6452, 6464, 6477, 6484, 6497, 6506, 6543, 6552, 6566, 6569, 6572, 6579, 6593, 6597, 6602, 6625, 6627, 6639, 6664, 6677, 6693, 6715, 6726, 6727, 6740, 6751, 6775, 6787, 6793, 6803, 6824, 6841, 6843, 6851, 6855, 6864, 6878, 6893, 6918, 6919, 6944, 6964, 6977, 6983, 7008, 7029, 7076, 7082, 7098, 7102, 7107, 7114, 7116, 7128, 7134, 7142, 7146, 7158, 7182, 7202, 7213, 7221, 7222, 7228, 7241, 7248, 7258, 7261, 7263, 7269, 7270, 7288, 7300, 7310, 7337, 7357, 7374, 7385, 7416, 7428, 7433, 7437, 7438, 7462, 7497, 7507, 7522, 7524, 7525, 7529, 7542, 7557, 7558, 7561, 7567, 7571, 7587, 7626, 7632, 7633, 7635, 7643, 7667, 7687, 7691, 7696, 7713, 7715, 7731, 7736, 7737, 7741, 7745, 7747, 7773, 7785, 7802, 7816, 7819, 7860, 7870, 7882, 7887, 7899, 7913, 7922, 7924, 7929, 7933, 7945, 7949, 7994, 8009, 8019, 8024, 8028, 8038, 8074, 8103, 8105, 8114, 8120, 8130, 8132, 8148, 8165, 8179, 8181, 8185, 8197, 8202, 8204, 8206, 8209, 8214, 8218, 8228, 8235, 8236, 8239, 8245, 8250, 8253, 8256, 8259, 8262, 8263, 8265, 8266, 8272, 8273, 8275, 8277, 8289, 8297, 8299, 8301, 8311, 8314, 8317, 8323, 8342, 8344, 8348, 8353, 8357, 8372, 8382, 8395, 8400, 8411, 8412, 8422, 8428, 8432, 8438, 8440, 8442, 8445, 8461, 8465, 8495, 8500, 8510, 8514, 8515, 8517, 8527, 8536, 8539, 8549, 8550, 8560, 8561, 8572, 8580, 8600, 8613, 8617, 8621, 8626, 8628, 8638, 8645, 8652, 8658, 8664, 8666, 8667, 8670, 8672, 8679, 8684, 8685, 8693, 8698, 8705, 8706, 8709, 8716, 8729, 8731, 8741, 8758, 8760, 8762, 8763, 8764, 8766, 8772, 8784, 8787, 8796, 8799, 8800, 8801, 8819, 8824, 8826, 8830, 8834, 8841, 8851, 8860, 8865, 8877, 8881, 8886, 8889, 8891, 8896, 8899, 8909, 8910, 8915, 8916, 8917, 8923, 8926, 8933, 8946, 8948, 8951, 8952, 8954, 8956, 8964, 8966, 8972, 8973, 8974, 8978, 8982, 8983, 8997, 8998, 9001, 9003, 9005, 9012, 9014, 9019, 9023, 9047, 9049, 9061, 9068, 9071, 9072, 9074, 9075, 9078, 9081, 9085, 9092, 9094, 9101, 9103, 9107, 9114, 9115, 9116, 9117, 9123, 9128, 9139, 9144, 9150, 9156, 9157, 9164, 9165, 9166, 9167, 9175, 9190, 9193, 9203, 9214, 9215, 9218, 9225, 9227, 9228, 9232, 9234, 9235, 9238, 9239, 9240, 9252, 9253, 9258, 9259, 9260, 9263, 9267, 9282, 9285, 9286, 9290, 9291, 9292, 9293, 9311, 9316, 9321, 9322, 9329, 9332, 9334, 9335, 9338, 9340, 9346, 9353, 9355, 9363, 9366, 9382, 9402, 9403, 9406, 9416, 9420, 9441, 9442, 9443, 9446, 9456, 9457, 9461, 9463, 9470, 9471, 9472, 9474, 9482, 9484, 9485, 9486, 9488, 9490, 9491, 9500, 9503, 9516, 9517, 9519, 9525, 9526, 9537, 9558, 9559, 9561, 9563, 9566, 9567, 9573, 9587, 9591, 9592, 9595, 9603, 9604, 9607, 9613, 9622, 9623, 9633, 9635, 9642, 9643, 9644, 9645, 9650, 9651, 9655, 9662, 9665, 9668, 9670, 9673, 9678, 9681, 9684, 9686, 9687, 9692, 9702, 9726, 9729, 9737, 9740, 9741, 9742, 9745, 9746, 9750, 9751, 9770, 9774, 9784, 9785, 9788, 9790, 9793, 9795, 9803, 9804, 9815, 9820, 9826, 9828, 9835, 9844, 9849, 9850, 9851, 9852, 9854, 9858, 9869, 9870, 9871, 9872, 9879, 9880, 9882, 9883, 9890, 9897, 9905, 9913, 9917, 9918, 9933, 9936, 9937, 9942, 9947, 9948, 9957, 9963, 9964, 9965, 9969, 9973, 9977, 9979, 9981, 9984, 9992, 9993, 9998, 10005, 10015, 10017, 10032, 10033, 10036, 10038, 10039, 10045, 10052, 10057, 10060, 10061, 10069, 10071, 10072, 10074, 10076, 10077, 10078, 10089, 10092, 10104, 10106, 10111, 10114, 10115, 10121, 10123, 10127, 10130, 10131, 10134, 10145, 10146, 10153, 10161, 10170, 10174, 10179, 10181, 10184, 10185, 10194, 10197, 10200, 10204, 10215, 10230, 10232, 10233, 10237, 10254, 10256, 10261, 10265, 10287, 10289, 10292, 10297, 10303, 10304, 10306, 10310, 10315, 10324, 10334, 10343, 10347, 10348, 10377, 10395, 10402, 10409, 10410, 10412, 10420, 10433, 10437, 10446, 10451, 10459, 10466, 10475, 10478, 10483, 10485, 10486, 10488, 10503, 10506, 10532, 10533, 10534, 10538, 10565, 10568, 10573, 10576, 10586, 10589, 10590, 10612, 10623, 10636, 10646, 10665, 10667, 10671, 10677, 10694, 10701, 10715, 10731, 10742, 10744, 10754, 10779, 10780, 10784, 10788, 10809, 10823, 10825, 10830, 10833, 10840, 10842, 10844, 10847, 10849, 10853, 10866, 10867, 10873, 10875, 10877, 10879, 10882, 10884, 10885, 10889, 10893, 10923, 10925, 10951, 10963, 10970, 10974, 10990, 10994, 11000, 11005, 11011, 11013, 11018, 11020, 11022, 11027, 11039, 11041, 11047, 11057, 11066, 11070, 11071, 11090, 11117, 11121, 11122, 11123, 11131, 11138, 11142, 11144, 11151, 11159, 11165, 11167, 11171, 11173, 11174, 11175, 11184, 11185, 11188, 11190, 11196, 11201, 11202, 11214, 11228, 11233, 11237, 11243, 11254, 11259, 11277, 11287, 11300, 11306, 11311, 11321, 11323, 11326, 11329, 11337, 11338, 11348, 11349, 11353, 11354, 11355, 11356, 11367, 11371, 11373, 11386, 11395, 11400, 11417, 11425, 11426, 11427, 11436, 11444, 11445, 11453, 11456, 11469, 11491, 11492, 11502, 11503, 11507, 11514, 11520, 11525, 11532, 11534, 11536, 11539, 11540, 11543, 11555, 11563, 11564, 11568, 11577, 11581, 11582, 11592, 11593, 11595, 11596, 11605, 11612, 11615, 11616, 11617, 11627, 11641, 11642, 11645, 11650, 11651, 11654, 11657, 11666, 11668, 11682, 11684, 11690, 11692, 11703, 11715, 11716, 11719, 11721, 11722, 11724, 11726, 11740, 11743, 11748, 11754, 11757, 11770, 11771, 11782, 11790, 11799, 11802, 11806, 11807, 11817, 11822, 11827, 11829, 11837, 11841, 11843, 11847, 11848, 11850, 11851, 11857, 11858, 11861, 11864, 11872, 11873, 11881, 11883, 11889, 11895, 11913, 11914, 11915, 11922, 11939, 11941, 11944, 11948, 11951, 11958, 11966, 11967, 11969, 11973, 11981, 11990, 12006, 12010, 12013, 12020, 12026, 12029, 12038, 12040, 12042, 12045, 12056, 12060, 12066, 12074, 12075, 12076, 12078, 12079, 12085, 12086, 12092, 12093, 12096, 12104, 12120, 12121, 12127, 12136, 12137, 12139, 12141, 12143, 12144, 12155, 12161, 12162, 12166, 12174, 12189, 12192, 12197, 12201, 12202, 12217, 12226, 12235, 12237, 12241, 12242, 12244, 12245, 12250, 12253, 12267, 12269, 12280, 12282, 12283, 4097, 4106, 4138, 4143, 4148, 4151, 4175, 4182, 4215, 4227, 4234, 4235, 4321, 4325, 4328, 4344, 4375, 4386, 4387, 4391, 4393, 4398, 4413, 4430, 4431, 4434, 4444, 4454, 4472, 4518, 4523, 4524, 4526, 4527, 4536, 4550, 4552, 4563, 4574, 4592, 4593, 4617, 4628, 4629, 4644, 4666, 4677, 4681, 4687, 4695, 4699, 4705, 4706, 4709, 4715, 4729, 4737, 4740, 4747, 4750, 4756, 4768, 4773, 4775, 4780, 4781, 4783, 4795, 4806, 4813, 4833, 4850, 4851, 4862, 4863, 4868, 4884, 4885, 4938, 4941, 4984, 4990, 5032, 5036, 5040, 5047, 5055, 5064, 5080, 5085, 5095, 5096, 5111, 5124, 5131, 5142, 5149, 5156, 5157, 5162, 5170, 5174, 5176, 5190, 5207, 5230, 5236, 5240, 5245, 5248, 5249, 5254, 5294, 5324, 5344, 5348, 5350, 5387, 5394, 5420, 5424, 5427, 5440, 5442, 5450, 5469, 5472, 5489, 5572, 5574, 5575, 5613, 5617, 5620, 5621, 5631, 5637, 5638, 5645, 5657, 5678, 5699, 5720, 5721, 5733, 5740, 5741, 5761, 5777, 5784, 5799, 5800, 5838, 5841, 5856, 5864, 5865, 5868, 5870, 5882, 5886, 5933, 5956, 6033, 6036, 6067, 6077, 6078, 6080, 6082, 6138, 6186, 6194, 6220, 6237, 6238, 6239, 6259, 6272, 6293, 6305, 6332, 6342, 6349, 6352, 6368, 6370, 6374, 6376, 6384, 6385, 6410, 6432, 6461, 6472, 6480, 6482, 6521, 6534, 6560, 6568, 6589, 6604, 6621, 6622, 6624, 6648, 6657, 6668, 6691, 6701, 6712, 6716, 6722, 6734, 6770, 6779, 6795, 6836, 6846, 6848, 6857, 6875, 6881, 6920, 6954, 6957, 6968, 6974, 6988, 6999, 7013, 7017, 7018, 7048, 7084, 7085, 7091, 7122, 7127, 7131, 7133, 7139, 7144, 7149, 7157, 7163, 7170, 7178, 7217, 7238, 7245, 7253, 7272, 7276, 7280, 7299, 7302, 7304, 7321, 7336, 7345, 7351, 7355, 7358, 7359, 7372, 7383, 7392, 7397, 7409, 7410, 7506, 7517, 7521, 7563, 7603, 7622, 7625, 7636, 7646, 7649, 7652, 7656, 7663, 7673, 7674, 7695, 7698, 7700, 7726, 7727, 7735, 7742, 7762, 7768, 7789, 7796, 7826, 7839, 7858, 7879, 7883, 7886, 7888, 7892, 7898, 7901, 7902, 7917, 7920, 7934, 7960, 7982, 7990, 7993, 8004, 8007, 8039, 8063, 8071, 8073, 8095, 8104, 8106, 8115, 8155, 8163, 8180, 8183, 8184, 8193, 8210, 8211, 8217, 8249, 8261, 8271, 8280, 8282, 8285, 8287, 8302, 8305, 8307, 8321, 8329, 8330, 8341, 8354, 8355, 8362, 8368, 8375, 8376, 8378, 8381, 8385, 8390, 8391, 8398, 8399, 8405, 8415, 8417, 8429, 8431, 8433, 8434, 8436, 8441, 8448, 8470, 8474, 8480, 8485, 8488, 8493, 8504, 8505, 8511, 8513, 8525, 8526, 8532, 8538, 8553, 8554, 8557, 8565, 8566, 8574, 8578, 8584, 8587, 8591, 8593, 8594, 8599, 8608, 8609, 8615, 8618, 8623, 8624, 8629, 8633, 8637, 8642, 8648, 8651, 8660, 8661, 8663, 8669, 8677, 8691, 8700, 8701, 8702, 8704, 8710, 8719, 8720, 8728, 8736, 8739, 8740, 8752, 8754, 8759, 8769, 8776, 8780, 8782, 8783, 8786, 8798, 8803, 8806, 8807, 8814, 8815, 8816, 8818, 8835, 8836, 8837, 8849, 8856, 8867, 8873, 8875, 8876, 8884, 8890, 8905, 8913, 8921, 8929, 8930, 8938, 8939, 8940, 8941, 8949, 8959, 8960, 8981, 8995, 9000, 9006, 9009, 9010, 9020, 9024, 9031, 9032, 9033, 9045, 9053, 9057, 9060, 9067, 9070, 9083, 9088, 9104, 9106, 9109, 9110, 9111, 9122, 9124, 9130, 9133, 9136, 9137, 9140, 9145, 9148, 9154, 9158, 9160, 9161, 9162, 9168, 9170, 9171, 9174, 9178, 9181, 9182, 9183, 9184, 9192, 9195, 9197, 9201, 9202, 9211, 9213, 9217, 9219, 9221, 9237, 9251, 9254, 9256, 9261, 9265, 9277, 9278, 9289, 9294, 9303, 9310, 9312, 9317, 9318, 9320, 9323, 9328, 9345, 9348, 9358, 9359, 9360, 9374, 9376, 9381, 9389, 9393, 9401, 9409, 9413, 9414, 9415, 9418, 9421, 9422, 9426, 9427, 9431, 9439, 9444, 9445, 9453, 9460, 9462, 9473, 9475, 9476, 9494, 9496, 9498]
            print "Bad addrs:", len(badaddrs)
            data = data[~data['addr'].isin(badaddrs)]

    pulses = []
    bers = []
    for maxpulses in range(200, 0, -1):
        data['success'] = data['success'].astype(bool) & (data['npulses'] <= maxpulses)
        data['npulses'] = data['npulses'].clip(upper=maxpulses)
        pulses.append(data['npulses'].mean())
        bers.append(1-data['success'].mean())
        # if maxpulses == 200:
        #     pulses.append(15)
        #     bers.append(1-data['success'].mean())
    bers = np.array(bers)*100
    if i != 1:
        plt.semilogy(pulses, bers)
    else:
        plt.semilogy(pulses, bers, '--')

    argerr = np.argmin(np.abs(bers - 1))
    print fname
    print pulses[argerr], bers[argerr]
    print pulses[argerr-1], bers[argerr-1]
    plt.annotate('%.2f' % pulses[argerr-1], xy=(pulses[argerr-1], bers[argerr-1]), xytext=(pulses[argerr-1]+0.9, 2), arrowprops=dict(facecolor='black', shrink=0.1, width=1, headwidth=3, headlength=5), fontsize=11, horizontalalignment='center', verticalalignment='center')

plt.semilogy([0, 15], [1, 1], ':')
plt.legend(['ISPP', 'FPPV (-11\% cells)', 'FPPV (orig)', 'SDCFC'], ncol=1, columnspacing=1, handletextpad=0.5, borderpad=0.2, prop={'size': 10})
plt.xlim(2, 15)
plt.ylim(0.6, 100)
ax.xaxis.set_major_formatter(FormatStrFormatter('%d'))
ax.yaxis.set_major_formatter(FormatStrFormatter('%d'))
plt.tight_layout()
plt.show()
